#' @title Read Model Output Files
#'
#' @description
#' Reads neural network parameters (weights, biases, activation functions) from
#' output files generated by an optimized training process and constructs a
#' complete model object.
#'
#' @param tmpDir Character string specifying the temporary directory path where
#'               the model output files are stored.
#' @param model_type Character string describing the type of model.
#' @param architecture Character string describing the neural network architecture.
#'
#' @return Returns an object of class \code{ccModel} containing:
#' \itemize{
#'   \item \code{Bias} - List of bias matrices for each layer
#'   \item \code{Theta} - List of weight matrices for each layer
#'   \item \code{Activation} - List of activation functions for each layer
#'   \item \code{Depth} - Integer specifying the number of layers
#'   \item \code{Model_type} - The input model type
#'   \item \code{Architecture} - The input architecture description
#' }
#'
#' @details
#' This function reads the following files from the specified directory:
#' \itemize{
#'   \item \code{Activations.csv} - Contains activation function names (one per line)
#'   \item \code{Bias{i}.csv} - Bias values for layer i (where i = 1, 2, ...)
#'   \item \code{Theta{i}.csv} - Weight values for layer i (where i = 1, 2, ...)
#' }
#'
#' The function automatically determines the network depth from the number of
#' activation functions and loads the corresponding parameters for each layer.
#' All CSV files are expected to be comma-separated without row names.
#'
#' @examples
#' \dontrun{
#' # Read model files from temporary directory
#' model <- readOutputFiles.optimized(
#'   tmpDir = "/path/to/model/files",
#'   Model_type = "Classification",
#'   architecture = "12"
#' )
#' }
#'
#' @export
#' @family DEGAS
#' @references Johnson TS, Yu CY, Huang Z, Xu S, Wang T, Dong C, et al. Diagnostic Evidence GAuge of Single cells (DEGAS): a flexible deep transfer learning framework for prioritizing cells in relation to disease. Genome Med. 2022 Feb 1;14(1):11.
#'
readOutputFiles.optimized <- function(tmpDir, model_type, architecture) {
    activations <- data.table::fread(
        file.path(tmpDir, 'Activations.csv'),
        header = FALSE,
        sep = "\n",
        showProgress = FALSE
    )[[1]]

    depth <- length(activations)
    file_indices <- seq_len(depth)

    # Read Bias files using purrr and data.table
    Biases <- purrr::map(
        file_indices,
        ~ {
            bias_file <- file.path(tmpDir, paste0('Bias', .x, '.csv'))
            bias_data <- data.table::fread(
                bias_file,
                header = FALSE,
                sep = ',',
                showProgress = FALSE
            )
            as.matrix(bias_data)
        }
    )

    # Read Theta files using purrr and data.table
    Thetas <- purrr::map(
        file_indices,
        ~ {
            theta_file <- file.path(tmpDir, paste0('Theta', .x, '.csv'))
            theta_data <- data.table::fread(
                theta_file,
                header = FALSE,
                sep = ',',
                showProgress = FALSE
            )
            as.matrix(theta_data)
        }
    )

    Activations <- as.list(activations)

    methods::new(
        'ccModel',
        Bias = Biases,
        Theta = Thetas,
        Activation = Activations,
        Depth = depth,
        Model_type = model_type,
        Architecture = architecture
    )
}
